(()=>{let i={Roundup:"Roundup",AMAZON:"Amazon",AMZN:"Amazon",COSTCO:"Costco",WALMART:"Walmart","CHICK-FIL-A":"Chick-fil-A","LA PUENTE":"La Puente","Prime Video":"Amazon Prime Video",MEGAPLEX:"Megaplex Theaters","BEANS & BREWS":"Bean"},a={COSTCO:"Groceries",WALMART:"Groceries",AMAZON:"Shopping",AMZN:"Shopping","CHICK-FIL-A":"Food","LA PUENTE":"Food","Prime Video":"Entertainment",MEGAPLEX:"Entertainment","HOT DOG":"Food",TACOS:"Food",Roundup:"Savings","BEANS & BREWS":"Coffee"},l=["Income","Other","Bills","Debt","Business","Freelance","Membership","Subscription","Snacks","Coffee","Food","Entertainment","Groceries","Transportation","Misc","Transfer","Savings","Pending"];function c(e){return null==e?'""':(e=String(e)).includes(",")||e.includes('"')||e.includes("\n")?'"'+e.replace(/"/g,'""')+'"':e}function e(){let r=[];return document.querySelectorAll(".transactions table.sc-gcUDKN").forEach(e=>{var n=e.previousElementSibling;if(n){n=n.textContent.trim();if("Scheduled"!==n){let t="Pending"===n;e.querySelectorAll("tbody tr").forEach(e=>{e=((t,n)=>{try{var r=t.querySelector(".col0");let e="";var o=r.querySelector("span:not(.visually-hidden)"),i=r.querySelector("span.visually-hidden"),a=(o&&""!==o.textContent.trim()?e=o.textContent.trim():i&&(e=i.textContent.trim()),t.querySelector(".col1.sr-mask span")),l=a?a.textContent.trim():"",c=t.querySelector(".col4 span"),d=c?c.textContent.trim():"";return{date:e,description:l,amount:d,isPending:n}}catch(e){return console.error("Error extracting row data:",e),null}})(e,t);e&&r.push(e)})}}}),r}function t(e){let o=[];return e.forEach(e=>{var t=(e=>{for(var t in i)if(e.includes(t))return i[t];return e})(e.description),n=(n=>{if(/^[A-Za-z]{3}\s\d{1,2}$/.test(n)){var r=(new Date).getFullYear();let[t,e]=n.split(" ");var o=["Jan","Feb","Mar","Apr","May","Jun","Jul","Aug","Sep","Oct","Nov","Dec"].findIndex(e=>t.startsWith(e));if(-1!==o)return o+1+`/${e}/`+r}return n})(e.date);let r="";r=e.isPending?"Pending":(e=>{for(var t in a)if(e.includes(t)){t=a[t];if(l.includes(t))return t}return""})(e.description);e=(e=>{let t=e.replace(/[$,]/g,"");var e=t.startsWith("-")||t.startsWith("(")&&t.endsWith(")"),n=(t=t.replace(/[()+-]/g,""),parseFloat(t));return(e?n:-n).toFixed(2)})(e.amount);o.push({description:t,account:"Sofi",date:n,category:r,amount:e})}),o.reverse()}function n(t){if(0===t.length)alert("No transactions found to export!");else{let i=["Description","Account","Date","Category","Amount"].join(",")+"\n";t.forEach(e=>{var t=c(e.description),n=c(e.account),r=c(e.date),o=c(e.category);i+=t+`,${n},${r},${o},${e.amount}
`});var t=i,n=new Blob([t],{type:"text/csv;charset=utf-8;"}),r=document.createElement("a");if(window.URL&&window.URL.createObjectURL)r.href=window.URL.createObjectURL(n),r.download="transactions.csv",document.body.appendChild(r),r.click(),document.body.removeChild(r);else{let e=document.createElement("div");e.style.position="fixed",e.style.top="0",e.style.left="0",e.style.width="100%",e.style.height="100%",e.style.backgroundColor="rgba(0, 0, 0, 0.7)",e.style.zIndex="9999",e.style.display="flex",e.style.justifyContent="center",e.style.alignItems="center";var n=document.createElement("div"),r=(n.style.backgroundColor="#fff",n.style.padding="20px",n.style.borderRadius="5px",n.style.maxWidth="80%",n.style.maxHeight="80%",n.style.overflowY="auto",document.createElement("h3")),o=(r.textContent="Copy the CSV data below:",document.createElement("textarea")),t=(o.value=t,o.style.width="100%",o.style.height="200px",o.style.marginTop="10px",document.createElement("button"));t.textContent="Close",t.style.marginTop="10px",t.style.padding="5px 15px",t.onclick=function(){document.body.removeChild(e)},n.appendChild(r),n.appendChild(o),n.appendChild(t),e.appendChild(n),document.body.appendChild(e),o.select()}}}console.log("Bank HTML to CSV Bookmarklet activated"),n(t(e()))})();